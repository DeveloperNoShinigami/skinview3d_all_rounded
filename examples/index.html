<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>skinview3d</title>
		<link rel="stylesheet" href="./style.css" />
		<style>
			body {
				margin: 0;
				padding: 20px;
				display: flex;
				flex-direction: row;
				gap: 20px;
				min-height: 100vh;
				box-sizing: border-box;
			}

			#skin_container {
				position: sticky;
				top: 20px;
				align-self: flex-start;
			}

			.controls {
				flex: 1;
				overflow-y: auto;
				padding-right: 20px;
			}

			@media (max-width: 1024px) {
				body {
					flex-direction: column;
				}

				#skin_container {
					width: 100%;
					height: 400px;
					position: relative;
					top: 0;
				}

				.controls {
					padding-right: 0;
				}
			}

			.control-section {
				margin-bottom: 20px;
				padding: 15px;
				background: #f5f5f5;
				border-radius: 8px;
			}

			.control-section h1 {
				margin-top: 0;
				font-size: 1.2em;
			}

			.control {
				margin: 5px 0;
			}

			footer {
				position: fixed;
				bottom: 0;
				left: 0;
				right: 0;
				background: white;
				padding: 10px 20px;
				text-align: center;
				border-top: 1px solid #eee;
			}
		</style>
	</head>

	<body>
		<canvas id="skin_container"></canvas>

		<div class="controls">
			<button id="reset_all" type="button" class="control">Reset All</button>
			<button id="add_model" type="button" class="control">Add Model</button>
			<button id="remove_model" type="button" class="control">Remove Model</button>
			<button id="change_positioning" type="button" class="control">Change Positioning</button>
			<button id="toggle_position_controller" type="button" class="control">Toggle Position Controller</button>
			<button id="export_joint_coordinates" type="button" class="control">Export Joint Coordinates</button>
			<label class="control"
				>Player:
				<select id="player_selector"></select
			></label>
			<label class="control"><input id="auto_fit" type="checkbox" checked /> Auto-fit players</label>
			<p class="control">
				Choose a player from the dropdown or click a model in the canvas to select it for editing. The selected model is
				highlighted with a green outline.
			</p>
			<div id="extra_player_controls" class="control-section"></div>

			<div id="main_menu" class="control-section">
				<button id="menu_skin" type="button" class="control" title="Load a new skin">Skin</button>
				<button id="menu_back" type="button" class="control" title="Load a cape or elytra">Back Items</button>
				<button id="menu_ears" type="button" class="control" title="Load an ears texture">Ears</button>
				<button id="menu_animation" type="button" class="control" title="Load an animation JSON">Animation</button>
			</div>
			<div id="sub_menu" class="control-section hidden"></div>

			<div class="control-section">
				<h1>Debug</h1>
				<label class="control"><input id="highlight_joints" type="checkbox" /> Highlight elbows/knees</label>
			</div>

			<div class="control-section">
				<h1>Animation Editor</h1>
				<button id="toggle_editor" type="button" class="control">Create Animation</button>
				<div id="animation_editor" class="hidden">
					<p class="control">
						Select an IK controller and drag its colored sphere in the viewer to pose the limb. Controllers are offset
						along the limb's forward direction so the spheres sit at the limb's end.
					</p>
					<label class="control">
						Bone:
						<select id="bone_selector">
							<option value="playerObject">Player</option>
							<option value="skin.head">skin.head</option>
							<option value="skin.body">skin.body</option>
							<option value="skin.rightUpperArm">skin.rightUpperArm</option>
							<option value="skin.rightElbow">skin.rightElbow</option>
							<option value="skin.rightLowerArm">skin.rightLowerArm</option>
							<option value="skin.leftUpperArm">skin.leftUpperArm</option>
							<option value="skin.leftElbow">skin.leftElbow</option>
							<option value="skin.leftLowerArm">skin.leftLowerArm</option>
							<option value="skin.rightUpperLeg">skin.rightUpperLeg</option>
							<option value="skin.rightKnee">skin.rightKnee</option>
							<option value="skin.rightLowerLeg">skin.rightLowerLeg</option>
							<option value="skin.leftUpperLeg">skin.leftUpperLeg</option>
							<option value="skin.leftKnee">skin.leftKnee</option>
							<option value="skin.leftLowerLeg">skin.leftLowerLeg</option>
							<option value="ik.rightArm">IK: Right Arm</option>
							<option value="ik.leftArm">IK: Left Arm</option>
							<option value="ik.rightLeg">IK: Right Leg</option>
							<option value="ik.leftLeg">IK: Left Leg</option>
						</select>
					</label>
					<p class="control">Shoulders and hips are rotation-locked and remain static.</p>
					<label class="control">
						Mode:
						<select id="transform_mode">
							<option value="rotate">Rotate</option>
							<option value="translate">Translate</option>
						</select>
					</label>
					<div id="timeline"></div>
					<button id="add_keyframe" type="button" class="control">Add Keyframe</button>
					<button id="download_json" type="button" class="control">Download JSON</button>
					<input id="upload_json" type="file" class="control" accept="application/json" />
					<button id="editor_play_pause" type="button" class="control">Play/Pause</button>
					<span id="upload_status" class="control hidden"></span>
				</div>
			</div>

			<div class="control-section">
				<h1>Viewport</h1>
				<div>
					<label class="control">Width: <input id="canvas_width" type="number" value="300" size="4" /></label>
					<label class="control">Height: <input id="canvas_height" type="number" value="300" size="4" /></label>
				</div>
				<div>
					<label class="control"
						>FOV: <input id="fov" type="number" value="70" step="1" min="1" max="179" size="2"
					/></label>
					<label class="control"
						>Zoom: <input id="zoom" type="number" value="0.90" step="0.01" min="0.01" max="2.00" size="4"
					/></label>
				</div>
			</div>

			<div class="control-section">
				<h1>Light</h1>
				<label class="control"
					>Global: <input id="global_light" type="number" value="3" step="0.01" min="0.00" max="2.00" size="4"
				/></label>
				<label class="control"
					>Camera: <input id="camera_light" type="number" value="0.60" step="0.01" min="0.00" max="2.00" size="4"
				/></label>
			</div>

			<div class="control-section">
				<h1>Rotation</h1>
				<label class="control"><input id="auto_rotate" type="checkbox" /> Enable</label>
				<label class="control"
					>Speed: <input id="auto_rotate_speed" type="number" value="2" step="0.1" size="3"
				/></label>
			</div>

			<div class="control-section">
				<h1>Animation</h1>
				<div id="animation_options"></div>
				<label class="control">Speed: <input id="animation_speed" type="number" value="1" step="0.1" size="3" /></label>
				<button id="animation_pause_resume" type="button" class="control">Pause / Resume</button>

				<br />
				<div class="control" id="crouch_setting" style="display: none">
					Crouch settings:
					<label><input type="checkbox" id="run_once" name="crouch_setting_item" value="runOnce" />Run once</label>
					<label
						><input type="checkbox" id="show_progress" name="crouch_setting_item" value="showProgress" />Show
						progress</label
					>
					<label>
						<input type="checkbox" id="add_hitting_animation" name="crouch_setting_item" value="addHitAnimation" />Add
						hitting animation</label
					>
					<br /><label class="control" id="hit_speed_label" style="display: none"
						>Hit speed :<input
							id="hit_speed"
							type="number"
							value=""
							step="0.1"
							size="3"
							placeholder="default following crouch speed"
							style="width: 190px"
					/></label>
				</div>
			</div>

			<div class="control-section">
				<h1>Mouse Control</h1>
				<div class="control">
					<label><input type="checkbox" id="control_rotate" checked /> Enable Rotate</label>
					<label><input type="checkbox" id="control_zoom" checked /> Enable Zoom</label>
					<label><input type="checkbox" id="control_pan" /> Enable Pan</label>
				</div>
			</div>

			<div class="control-section">
				<h1>Skin Layers</h1>
				<table id="layers_table">
					<thead>
						<tr>
							<th></th>
							<th>head</th>
							<th>body</th>
							<th>right upper arm</th>
							<th>left upper arm</th>
							<th>right upper leg</th>
							<th>left upper leg</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<th>inner</th>
							<td><input type="checkbox" data-layer="innerLayer" data-part="head" checked /></td>
							<td><input type="checkbox" data-layer="innerLayer" data-part="body" checked /></td>
							<td><input type="checkbox" data-layer="innerLayer" data-part="rightUpperArm" checked /></td>
							<td><input type="checkbox" data-layer="innerLayer" data-part="leftUpperArm" checked /></td>
							<td><input type="checkbox" data-layer="innerLayer" data-part="rightUpperLeg" checked /></td>
							<td><input type="checkbox" data-layer="innerLayer" data-part="leftUpperLeg" checked /></td>
						</tr>
						<tr>
							<th>outer</th>
							<td><input type="checkbox" data-layer="outerLayer" data-part="head" checked /></td>
							<td><input type="checkbox" data-layer="outerLayer" data-part="body" checked /></td>
							<td><input type="checkbox" data-layer="outerLayer" data-part="rightUpperArm" checked /></td>
							<td><input type="checkbox" data-layer="outerLayer" data-part="leftUpperArm" checked /></td>
							<td><input type="checkbox" data-layer="outerLayer" data-part="rightUpperLeg" checked /></td>
							<td><input type="checkbox" data-layer="outerLayer" data-part="leftUpperLeg" checked /></td>
						</tr>
					</tbody>
				</table>
			</div>

			<div class="control-section">
				<h1>Background</h1>
				<div class="control">
					<label
						>Type:
						<select id="background_type" value="panorama">
							<option value="color">Solid Color</option>
							<option value="panorama">Panorama</option>
						</select>
					</label>
				</div>
				<div id="background_color_options" class="control">
					<label
						>Color:
						<select id="background_color">
							<option value="#c2b4ff">Purple (#c2b4ff)</option>
							<option value="#87CEEB">Sky Blue (#87CEEB)</option>
							<option value="#90EE90">Light Green (#90EE90)</option>
							<option value="#FFB6C1">Light Pink (#FFB6C1)</option>
							<option value="#DDA0DD">Plum (#DDA0DD)</option>
						</select>
					</label>
				</div>
			</div>

			<div class="control-section">
				<h1>Panorama</h1>
				<div class="control">
					<label
						>URL:
						<input
							id="panorama_url"
							type="text"
							value="img/panorama.png"
							placeholder="none"
							list="default_panorama"
							size="20"
					/></label>
					<datalist id="default_panorama">
						<option value=""></option>
						<option value="img/panorama.png"></option>
					</datalist>
					<input id="panorama_url_upload" type="file" class="hidden" accept="image/*" />
					<button id="panorama_url_unset" type="button" class="control hidden">Unset</button>
					<button type="button" class="control" onclick="document.getElementById('panorama_url_upload').click();">
						Browse...
					</button>
				</div>
			</div>

			<div class="control-section">
				<h1>Name Tag</h1>
				<div class="control">
					<label>Text: <input id="nametag_text" type="text" value="" placeholder="none" size="20" /></label>
				</div>
			</div>

			<div class="control-section">
				<h1>Other examples</h1>
				<ul>
					<li><a href="offscreen-render.html">offscreen-render</a></li>
				</ul>
			</div>
		</div>

		<footer>
			<div>GitHub: <a href="https://github.com/bs-community/skinview3d">bs-community/skinview3d</a></div>
			<!--%%deploy_only%%
			<div>
				Built from
				commit <a href="https://github.com/bs-community/skinview3d/commit/{{build_commit}}">{{build_commit}}</a>
				at <time datetime="{{build_time}}">{{build_time}}</time>
			</div>
		-->
		</footer>
		<script type="module" src="./main.ts" defer></script>

		<script
			type="module"
			src="https://unpkg.com/stats.js@0.17.0/src/Stats.js"
			integrity="sha384-W71K+d2HbqXqQWSj3Vj4RDsIVvIV7lR8O6RArKAiqB39ntwLci0W08qOn4Z1n8sM"
			crossorigin="anonymous"
			async
		></script>
		<script type="module" async>
			import Stats from "https://unpkg.com/stats.js@0.17.0/src/Stats.js";
			const stats = new Stats();
			stats.dom.style.left = "";
			stats.dom.style.right = "0";
			document.body.appendChild(stats.dom);
			function loop() {
				stats.update();
				requestAnimationFrame(loop);
			}
			requestAnimationFrame(loop);
		</script>
	</body>
</html>
